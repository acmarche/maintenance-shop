{% extends '@AcMarcheMaintenanceShop/layout.html.twig' %}

{% block body %}
    <div class="page-header">
        <h3>Rechercher des produits</h3>
    </div>

    {% include '@AcMarcheMaintenanceShop/search/produit.html.twig' with {'form': search_form } %}

    <br/>
    {% if search and produits | length == 0 %}
        <p class="text-warning">Aucun produit trouvé</p>
    {% endif %}

    {% if produits | length > 0 %}
        {{ form_start(form, { 'attr': {'class': 'form-inline'}}) }}
        {{ form_errors(form) }}
        <table class="table table-bordered">

            {% for produit in produits %}
                <tr>
                    <td style="width: 50%;">
                        <h5 class="text-success">{{ produit.nom }}
                            {% if produit.unite %}
                                <strong>(<i>{{ produit.unite }}</i>)</strong>
                            {% endif %}
                        </h5>
                        <span class="text-muted">{{ produit.description }}</span>
                        <br clear="all"/>
                        <label class="my-1 mr-2" for="commande_quantite_{{ produit.id }}"
                               style="text-align: left; justify-content:left; ">Quantité</label>
                        <input type="number" id="commande_quantite_{{ produit.id }}" name="quantite" min="1" max="999"
                               class="form-control mb-2 mr-sm-2 w-2566" required="required" value="1"
                               placeholder="Quantité">

                        <button type="button" name="commande[submit]" data-produit="{{ produit.id }}"
                                class="btn-primary btn bouton-add">
                            <i class="fas fa-plus"></i> Ajouter
                        </button>
                    </td>
                    <td>
                        {% if produit.associatedProducts | length > 0 %}
                            <h6><strong>Produits associés</strong></h6>
                            {% for product in produit.associatedProducts %}
                                <a href="{{ path('acmaintenance_commande_show_produit', { 'id': produit.id }) }}">
                                    {{ product.nom }}
                                </a>
                            {% endfor %}
                        {% endif %}
                        <div id="commande_result_{{ produit.id }}" class="form-group" style="margin-left: 20px;">

                        </div>
                    </td>
                </tr>
            {% endfor %}
        </table>
        {{ form_end(form) }}
    {% endif %}

{% endblock %}
{% block scripts %}
    <script>
        $(".bouton-add").click(function () {
            var produitId = jQuery(this).attr("data-produit");
            var quantite = $("#commande_quantite_" + produitId).val();

            $.post("{{ path('acmaintenance_commande_add') }}",
                {
                    produit: produitId,
                    quantite: quantite
                },
                function (data, status) {
                    $("#commande_result_" + produitId).html(data);
                });
        });
    </script>
{% endblock %}
